<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoUpload Pro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .progress {
            margin: 20px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            display: none;
        }
        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        .file-list {
            margin: 20px 0;
        }
        .file-item {
            padding: 10px;
            background: #f8f9fa;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¶ VideoUpload Pro</h1>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ Dropbox</p>

        <div id="alertContainer"></div>

        <form id="uploadForm">
            <div class="form-group">
                <label for="artikul">üè∑Ô∏è –ê—Ä—Ç–∏–∫—É–ª:</label>
                <input type="text" id="artikul" name="artikul" required>
            </div>

            <div class="form-group">
                <label for="date">üìÖ –î–∞—Ç–∞:</label>
                <input type="date" id="date" name="date" required>
            </div>

            <div class="form-group">
                <label for="description">üìù –û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="description" name="description" required></textarea>
            </div>

            <div class="form-group">
                <label for="files">üì± –í–∏–¥–µ–æ —Ñ–∞–π–ª—ã:</label>
                <input type="file" id="files" multiple accept="video/*" required>
            </div>

            <div id="fileList" class="file-list"></div>

            <div id="progress" class="progress">
                <div>–°—Ç–∞—Ç—É—Å: <span id="progressText">–ì–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ</span></div>
            </div>

            <button type="submit" id="submitBtn">üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</button>
        </form>

        <div id="results" style="display: none; margin-top: 30px;">
            <h3>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ü–†–û–°–¢–û–ô –ò –ù–ê–î–ï–ñ–ù–´–ô –ö–û–î
        console.log('üö® JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω!');

        let selectedFiles = [];

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
        document.getElementById('date').value = new Date().toISOString().split('T')[0];

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
        document.getElementById('files').addEventListener('change', function(e) {
            console.log('üìÅ –§–∞–π–ª—ã –≤—ã–±—Ä–∞–Ω—ã:', e.target.files.length);
            selectedFiles = Array.from(e.target.files);
            updateFileList();
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }

            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-item">
                    <span>üìπ ${file.name} (${formatFileSize(file.size)})</span>
                    <button type="button" class="remove-btn" onclick="removeFile(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }

        // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertContainer.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üö®üö®üö® –§–û–†–ú–ê –û–¢–ü–†–ê–í–õ–ï–ù–ê!');

            const submitBtn = document.getElementById('submitBtn');
            const progress = document.getElementById('progress');
            const progressText = document.getElementById('progressText');

            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (selectedFiles.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã!');
                return;
            }

            try {
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                progress.style.display = 'block';
                submitBtn.disabled = true;
                submitBtn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∂–∞—é...';
                progressText.textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ...';

                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const formData = new FormData();
                formData.append('artikul', document.getElementById('artikul').value);
                formData.append('date', document.getElementById('date').value);
                formData.append('description', document.getElementById('description').value);

                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã
                selectedFiles.forEach(file => {
                    formData.append('videos', file);
                });

                console.log('üì¶ FormData –≥–æ—Ç–æ–≤, –æ—Ç–ø—Ä–∞–≤–ª—è—é...');
                progressText.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è—é —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä...';

                // –û–¢–ü–†–ê–í–ö–ê –ó–ê–ü–†–û–°–ê
                console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞:', window.location.origin + '/upload');
                
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                console.log('üì® –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', response.status);

                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                    
                    progressText.textContent = '‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!';
                    showResult(result);
                    showAlert('–§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', 'success');
                } else {
                    const error = await response.text();
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', error);
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
                }

            } catch (error) {
                console.error('üí• –û—à–∏–±–∫–∞:', error);
                progressText.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                showAlert('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ';
            }
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        function showResult(result) {
            const resultsDiv = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            resultContent.innerHTML = `
                <p><strong>–ê—Ä—Ç–∏–∫—É–ª:</strong> ${result.artikul}</p>
                <p><strong>–î–∞—Ç–∞:</strong> ${result.date}</p>
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${result.description}</p>
                <p><strong>–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:</strong> ${result.uploaded_files.length}</p>
                <p><strong>–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏:</strong> ${result.total_duration}</p>
                <div style="margin: 20px 0;">
                    <a href="${result.folder_link}" target="_blank" style="display: inline-block; background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin-right: 10px;">üì¶ –û—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É Dropbox</a>
                    ${result.sheet_link ? `<a href="${result.sheet_link}" target="_blank" style="display: inline-block; background: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">üìä –û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>` : ''}
                </div>
            `;
            
            resultsDiv.style.display = 'block';
            document.getElementById('uploadForm').scrollIntoView();
        }

        console.log('‚úÖ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã!');
    </script>
</body>
</html>